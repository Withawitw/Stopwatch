<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stopwatch with Clock</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
        }
        .stopwatch {
            text-align: center;
            max-width: 90%;
            margin: auto;
        }
        .time, .clock {
            font-size: 3em; /* เปลี่ยนขนาดฟอนต์ให้ใหญ่ขึ้น */
            margin-bottom: 15px;
        }
        .buttons button {
            font-size: 0.8em;
            padding: 8px 15px;
            margin: 5px;
        }
        .log {
            margin-top: 15px;
        }
        .log ul {
            list-style: none;
            padding: 0;
        }
        .log-item {
            display: flex;
            align-items: center;
            margin-bottom: 3px;
        }
        .log-item span {
            margin-right: 5px;
        }
        .log-item input {
            flex-grow: 1;
            font-size: 0.8em;
            padding: 5px;
        }
    </style>
</head>
<body>
    <div class="stopwatch">
        <div class="clock" id="clock"></div>
        <div class="time" id="time">00:00:00</div>
        <div class="buttons">
            <button id="startStopBtn">Start</button>
            <button id="timestampBtn" style="display: none;">Timestamp</button>
            <button id="clearLogBtn" style="display: none;">Clear Log</button>
            <button id="saveLogBtn" style="display: none;">Save Log</button>
        </div>
        <div class="log">
            <h3>Log</h3>
            <ul id="logList"></ul>
        </div>
    </div>

    <script>
      let startTime, updatedTime, difference, tInterval;
let savedTime = 0;
let running = false;
let timestampCount = 0;

const timeDisplay = document.getElementById('time');
const clockDisplay = document.getElementById('clock');
const logList = document.getElementById('logList');
const startStopBtn = document.getElementById('startStopBtn');
const timestampBtn = document.getElementById('timestampBtn');
const clearLogBtn = document.getElementById('clearLogBtn');
const saveLogBtn = document.getElementById('saveLogBtn');

startStopBtn.addEventListener('click', toggleStartStop);
timestampBtn.addEventListener('click', logTimestamp);
clearLogBtn.addEventListener('click', clearLog);
saveLogBtn.addEventListener('click', saveLog);

function toggleStartStop() {
    if (!running) {
        start();
        startStopBtn.textContent = 'Stop';
        timestampBtn.style.display = 'inline-block'; // แสดงปุ่ม Timestamp เมื่อกด Start
        clearLogBtn.style.display = 'none'; // ซ่อนปุ่ม Clear Log เมื่อกด Start
        saveLogBtn.style.display = 'none'; // ซ่อนปุ่ม Save Log เมื่อกด Start
    } else {
        stop();
        startStopBtn.textContent = 'Start';
        timestampBtn.style.display = 'none'; // ซ่อนปุ่ม Timestamp เมื่อกด Stop
        clearLogBtn.style.display = 'inline-block'; // แสดงปุ่ม Clear Log เมื่อกด Stop
        saveLogBtn.style.display = 'inline-block'; // แสดงปุ่ม Save Log เมื่อกด Stop
    }
}

function start() {
    if (!running) {
        startTime = new Date().getTime() - savedTime;
        tInterval = setInterval(updateTime, 1);
        running = true;
        logAction('Started');
        saveLogBtn.disabled = true;
    }
}

function logTimestamp() {
    if (running) {
        logAction('Timestamp', true);
    }
}

function stop() {
    if (running) {
        logAction('Stopped');
        clearInterval(tInterval);
        savedTime = 0;
        running = false;
        timeDisplay.innerHTML = "00:00:00";
        saveLogBtn.disabled = false;
    }
}

function updateTime() {
    updatedTime = new Date().getTime();
    difference = updatedTime - startTime;

    let hours = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    let minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
    let seconds = Math.floor((difference % (1000 * 60)) / 1000);

    hours = (hours < 10) ? "0" + hours : hours;
    minutes = (minutes < 10) ? "0" + minutes : minutes;
    seconds = (seconds < 10) ? "0" + seconds : seconds;

    timeDisplay.innerHTML = hours + ':' + minutes + ':' + seconds;
}

function logAction(action, withInput = false) {
    const stopwatchTime = timeDisplay.innerHTML;
    const currentTime = new Date();
    const clockTime = currentTime.toTimeString().split(' ')[0];
    timestampCount++;
    const listItem = document.createElement('li');
    listItem.className = 'log-item';
    listItem.innerHTML = `
        <span>${timestampCount}. ${action} at ${stopwatchTime} (Clock: ${clockTime})</span>
        ${withInput ? '<input type="text" placeholder="Enter details...">' : ''}
    `;
    logList.appendChild(listItem);
}

function clearLog() {
    logList.innerHTML = '';
    timestampCount = 0;
}

function saveLog() {
    const name = prompt("Please enter your name:");
    if (name) {
        const logText = `${name}'s Log\n\n` + Array.from(logList.children)
            .map(item => item.textContent.trim())
            .join('\n');
        const blob = new Blob([logText], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'stopwatch_log.txt';
        a.click();
        URL.revokeObjectURL(url);
    } else {
        alert("Name cannot be empty. Log not saved.");
    }
}
    </script>
</body>
</html>
